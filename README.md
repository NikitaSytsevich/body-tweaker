# Body Tweaker

Telegram Mini App для практики голодания и дыхательных упражнений с наглядной «картой метаболизма», базой знаний и журналом прогресса. Приложение работает в Telegram и в браузере (с безопасными фолбэками), хранит данные в Telegram Cloud Storage и локально, шифрует их на клиенте.

## Что есть в приложении

### Основные экраны

- **Карта метаболизма**
  Карта из 15 фаз с текущим статусом, прогрессом по активной фазе и подробными карточками (физиология, ощущения, рекомендации, меры предосторожности). Во время голодания карта открывается по умолчанию.

- **База знаний**
  Раздел статей внутри экрана «Карта». Статьи открываются в деталях на отдельной странице.

- **Таймер голодания**
  Кольцевой таймер с прогрессом, выбор протокола, старт/стоп, редактируемые время начала и окончания. После старта доступен быстрый переход на карту.

- **Дыхательная практика**
  Гиповентиляционная практика с уровнями сложности, визуальной анимацией фаз вдоха/задержки/выдоха, звуковыми сигналами, вибрацией и таймером сессии.

- **История и прогресс**
  Единый журнал для голоданий и дыхательных сессий: статистика, календарь, список сессий, карточка деталей с редактированием времени и удалением записей.

- **Профиль и настройки**
  Настройки темы, установки на главный экран, резервных копий, правовых документов и раздел «О проекте».

### Протоколы голодания (7)

- 24ч — «База аутофагии»
- 36ч — «Метаболический сброс»
- 48ч — «Иммунная перезагрузка»
- 72ч — «Регенерация (3 суток)»
- 96ч — «Нейрогенез (4 суток)»
- 120ч — «Омоложение (5 суток)»
- 168ч — «Полное обновление (7 дней)»

Для каждого протокола доступен обзор с количеством фаз и маршрутом по фазам.

### Дыхательная практика

- 13 уровней сложности (0–12) с фиксированными схемами вдох/задержка/выдох.
- Звуковые подсказки фаз и сигнал завершения.
- 4 фоновых аудиотрека: огонь, дождь, ветер, космос.
- Регулировка громкости музыки и сигналов отдельно.
- Вибрация при смене фаз (если поддерживается устройством).
- Информационная памятка по технике и безопасности.

### База знаний (11 статей)

- «Проверьте риски»
- «Голодание и искусство есть по Шелтону»
- «Чудо голодания по Полю Брэггу»
- «Китайское исследование: Питание и болезни»
- «Как не умереть раньше времени»
- «Ешь и худей по Фурману»
- «Мясо для слабаков»
- «Сыроедческая монодиета»
- «Курение и вейпы при голодании: Полная правда»
- «Голодание при сахарном диабете: Полное руководство»
- «Микропорции и паузы»

## Данные и безопасность

- **Шифрование**: все пользовательские данные шифруются AES на клиенте.
- **Хранение**: при наличии Telegram Cloud Storage данные сохраняются в облако, при отсутствии — в localStorage.
- **Очередь синхронизации**: при сбоях Cloud Storage изменения сохраняются локально и синхронизируются позже.
- **История**: записи хранятся чанками (8 записей в чанке, до 1000 записей) для обхода лимита 4096 байт Telegram Cloud Storage.
- **Резервные копии**: экспорт и импорт JSON из настроек.

## Установка и запуск

### Требования

- Node.js >= 18
- npm >= 9

### Быстрый старт

```bash
npm install

# создайте .env
# VITE_STORAGE_KEY=ваш_секретный_ключ

npm run dev
```

Приложение будет доступно по адресу `http://localhost:5173`.

### Переменные окружения

- `VITE_STORAGE_KEY` — ключ для шифрования данных. В продакшене обязателен: сборка упадет с ошибкой, если ключ не задан.
- `VITE_SENTRY_DSN` — опционально. Включает мониторинг ошибок (Sentry).
- `VITE_HISTORY_RETENTION_DAYS` — опционально. Сколько дней хранить историю (по умолчанию не ограничено).

## Скрипты

- `npm run dev` — запуск dev-сервера
- `npm run build` — TypeScript проверка и production сборка
- `npm run lint` — ESLint
- `npm run preview` — локальный просмотр production сборки
- `npm run generate-icons` — генерация PWA иконок
- `npm run audit` — генерация аудита (scripts/generate-audit.js)
- `npm run test` — unit-тесты (vitest)
- `npm run test:e2e` — E2E тесты (Playwright, требуется `npx playwright install`)

## Развертывание

1. Соберите приложение: `npm run build`.
2. Разместите содержимое папки `dist/` на статическом хостинге с HTTPS.
3. В BotFather укажите URL как Mini App. Для корректной работы Telegram требует HTTPS.

## Технологии

- React 19, TypeScript, Vite
- Telegram Web App SDK
- Tailwind CSS, Framer Motion
- Crypto-js (AES), Day.js
- Vite PWA (service worker и manifest)

## Лицензия

MIT
