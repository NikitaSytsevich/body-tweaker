import {
  Utensils,
  Activity,
  Battery,
  Flame,
  Zap,
  Leaf,
  Trophy,
  Shield,
  Moon,
} from 'lucide-react';
import type { LucideIcon } from 'lucide-react';

export interface FastingStage {
  id: number;
  hoursStart: number;
  hoursEnd: number | null;
  title: string;
  subtitle: string;
  icon: LucideIcon;
  details: {
    physiology: string;
    sensations: string[];
  };
  recommendations: string[];
  precautions: string[];
  color: string;
}

const getPhaseClassParts = (phase: FastingStage) => phase.color.split(' ').filter(Boolean);

export const getPhaseTextClasses = (phase: FastingStage) => {
  const parts = getPhaseClassParts(phase);
  const light = parts.find((c) => c.startsWith('text-')) || 'text-slate-600';
  const dark = parts.find((c) => c.startsWith('dark:text-'));
  return dark ? `${light} ${dark}` : light;
};

export const getPhaseBgClasses = (phase: FastingStage) => {
  const parts = getPhaseClassParts(phase);
  const light = parts.find((c) => c.startsWith('bg-')) || 'bg-slate-100';
  const dark = parts.find((c) => c.startsWith('dark:bg-'));
  return dark ? `${light} ${dark}` : light;
};

export const getPhaseSoftBgClasses = (phase: FastingStage) => {
  const parts = getPhaseClassParts(phase);
  const light = parts.find((c) => c.startsWith('bg-')) || 'bg-slate-100';
  const softLight = light
    .replace('-100', '-50')
    .replace('-200', '-50')
    .replace('-300', '-100');
  const dark = parts.find((c) => c.startsWith('dark:bg-'));
  return dark ? `${softLight} ${dark}` : softLight;
};

export const getPhaseAccentTextClasses = (phase: FastingStage) => {
  const parts = getPhaseClassParts(phase);
  const light = parts.find((c) => c.startsWith('text-')) || 'text-slate-600';
  const dark = parts.find((c) => c.startsWith('dark:text-'));
  const accent = light.replace(/-600\b/, '-500').replace(/-700\b/, '-600');
  return dark ? `${accent} ${dark}` : accent;
};

export const FASTING_PHASES: FastingStage[] = [
  {
    id: 1,
    hoursStart: 0,
    hoursEnd: 4,
    title: 'Пищевая фаза',
    subtitle: 'Пищеварение и насыщение',
    icon: Utensils,
    color: 'bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300',
    details: {
      physiology:
        'В первые часы после последнего приема пищи доминирует абсорбтивный режим: глюкоза, аминокислоты и жирные кислоты из кишечника продолжают поступать в кровь, а инсулин остается относительно высоким. Под его действием активируются переносчики глюкозы в тканях, усиливается синтез гликогена в печени и мышцах, а липолиз в жировой ткани частично подавляется.\n\nПечень перераспределяет питательные субстраты между периферическими тканями и пополняет энергетические депо. В этот момент организм преимущественно расходует внешние источники энергии, а не внутренние запасы.\n\nНейроэндокринный профиль еще близок к «режиму питания»: глюкагон и контринсулярные гормоны не являются ведущими регуляторами, поэтому метаболический переход пока выражен слабо.',
      sensations: [
        'Чувство сытости и относительно стабильная энергия.',
        'Иногда сонливость после последнего приема пищи.',
        'Голод обычно минимален или отсутствует.',
      ],
    },
    recommendations: [
      'Поддерживайте питьевой режим: вода небольшими порциями в течение дня.',
      'Избегайте тяжелой физической нагрузки сразу после старта.',
      'Сохраняйте спокойный ритм, без перегруза задачами.',
    ],
    precautions: [
      'При выраженной боли в животе, тошноте или рвоте лучше прекратить практику и оценить состояние.',
      'Если есть хронические заболевания ЖКТ, старт нужно согласовывать с врачом.',
    ],
  },
  {
    id: 2,
    hoursStart: 4,
    hoursEnd: 12,
    title: 'Постабсорбтивный переход',
    subtitle: 'Снижение инсулина',
    icon: Activity,
    color: 'bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-300',
    details: {
      physiology:
        'На интервале 4-12 часов абсорбция пищи постепенно затухает, а уровень инсулина снижается до базовых значений. На этом фоне повышается роль глюкагона: печень начинает активнее отдавать глюкозу в кровь за счет распада гликогена, поддерживая стабильное снабжение тканей.\n\nЛиполиз в жировой ткани постепенно разблокируется, в кровь поступает больше свободных жирных кислот. Эти субстраты уже начинают подхватываться мышцами и печенью, но углеводный путь еще сохраняет заметную долю в общем энергобалансе.\n\nМетаболическая картина становится переходной: организм одновременно завершает «постпрандиальные» процессы и запускает более автономное энергоснабжение.',
      sensations: [
        'Появляются первые волны голода в привычные часы еды.',
        'Энергия может слегка снижаться к концу интервала.',
        'Возможна раздражительность при высоком уровне стресса.',
      ],
    },
    recommendations: [
      'Пейте воду регулярно, не дожидаясь сильной жажды.',
      'Поддерживайте легкую активность: ходьба, бытовые дела, мягкая мобилизация.',
      'Снижайте информационный стресс и избегайте эмоциональных перегрузок.',
    ],
    precautions: [
      'При выраженном головокружении или предобморочном состоянии голодание лучше остановить.',
      'Людям с нарушением углеводного обмена нужен более частый контроль самочувствия.',
    ],
  },
  {
    id: 3,
    hoursStart: 12,
    hoursEnd: 18,
    title: 'Расход гликогена',
    subtitle: 'Переход на внутренние запасы',
    icon: Battery,
    color: 'bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-300',
    details: {
      physiology:
        'К 12-18 часу вклад печеночного гликогена в поддержание глюкозы становится максимальным: депо продолжают уменьшаться, а скорость глюконеогенеза постепенно растет. В печени усиливается использование лактата, глицерола и части аминокислот как субстратов для синтеза глюкозы.\n\nСвободные жирные кислоты в крови увеличиваются, и периферические ткани чаще переключаются на бета-окисление. Это снижает «давление» на глюкозный путь и подготавливает условия для более активного кетогенеза в следующих окнах.\n\nГормонально этап характеризуется относительным преобладанием контринсулярных сигналов над инсулиновыми, что постепенно меняет энергетическую стратегию организма от «приема и хранения» к «мобилизации и экономии».',
      sensations: [
        'Голод может быть заметным, но чаще волнообразным.',
        'Возможна легкая слабость или ощущение "пустоты" в теле.',
        'Часть людей отмечает падение концентрации ближе к 16-18 часу.',
      ],
    },
    recommendations: [
      'Сохраняйте ровный темп дня без силовых пиков.',
      'Делайте короткие прогулки и дыхательные паузы.',
      'Поддерживайте сон и ранний вечерний отдых.',
    ],
    precautions: [
      'Если слабость быстро нарастает, лучше завершить протокол мягким выходом.',
      'При терапии, влияющей на сахар или давление, не продолжайте без контроля врача.',
    ],
  },
  {
    id: 4,
    hoursStart: 18,
    hoursEnd: 24,
    title: 'Метаболическое переключение',
    subtitle: 'Граница первого дня',
    icon: Flame,
    color: 'bg-rose-100 text-rose-600 dark:bg-rose-900/30 dark:text-rose-300',
    details: {
      physiology:
        'На рубеже 18-24 часов запасы печеночного гликогена приближаются к функциональному минимуму. Из-за этого резко возрастает значение липолиза: жировая ткань активнее высвобождает жирные кислоты, а печень увеличивает их окисление.\n\nВ митохондриях печени заметно ускоряется кетогенез, и концентрация кетоновых тел в крови начинает устойчиво расти. Для тканей это сигнал о переходе к новому энергетическому профилю, где доля кетонов будет последовательно увеличиваться.\n\nОдновременно из-за низкого инсулина усиливается натрийурез и меняется водно-электролитная динамика. Это нормальный компонент ранней адаптации, который отражает системную перестройку регуляции.',
      sensations: [
        'Голод может ослабевать после нескольких волн.',
        'Часто ощущаются холодные конечности и снижение выносливости.',
        'У некоторых появляется ментальная ясность на фоне снижения физической энергии.',
      ],
    },
    recommendations: [
      'Пейте воду, при необходимости добавляйте немного соли по переносимости.',
      'Избегайте интенсивных тренировок и длинных стрессовых совещаний.',
      'Выделяйте время на восстановление и сон.',
    ],
    precautions: [
      'Тахикардия, выраженная дрожь или предобморочное состояние - повод прекратить голодание.',
      'При боли в груди или одышке нужна срочная медицинская помощь.',
    ],
  },
  {
    id: 5,
    hoursStart: 24,
    hoursEnd: 36,
    title: 'Старт кетозной адаптации',
    subtitle: 'Начало использования кетонов',
    icon: Zap,
    color: 'bg-violet-100 text-violet-600 dark:bg-violet-900/30 dark:text-violet-300',
    details: {
      physiology:
        'После 24 часов доля энергии из жирных кислот и кетоновых тел становится существенно выше, чем в ранние часы. Печень продолжает синтез кетонов, а периферические ткани активнее используют их как окислительный субстрат.\n\nГлюконеогенез сохраняется, поскольку ряд клеток (в том числе эритроциты) по-прежнему нуждается в глюкозе. Однако общая потребность организма в глюкозе постепенно снижается за счет кетоадаптации и перераспределения топлива между тканями.\n\nНа клеточном уровне усиливаются сигналы энергетического дефицита (включая AMPK-путь) и снижается активность анаболических путей, что сопровождает переход в режим «ремонта и экономии ресурсов».',
      sensations: [
        'Голод становится менее навязчивым по сравнению с первым днем.',
        'Физическая работоспособность обычно ниже привычной.',
        'Может расти субъективная ясность мышления.',
      ],
    },
    recommendations: [
      'Держите спокойный режим активности и избегайте перегрева.',
      'Следите за водно-солевым балансом и самочувствием в динамике.',
      'Планируйте день так, чтобы был доступ к отдыху.',
    ],
    precautions: [
      'При прогрессирующей слабости, головокружении или рвоте прекращайте практику.',
      'Людям с хроническими заболеваниями лучше не продолжать без наблюдения специалиста.',
    ],
  },
  {
    id: 6,
    hoursStart: 36,
    hoursEnd: 48,
    title: 'Ранний устойчивый кетоз',
    subtitle: 'Энергия из жиров и кетонов',
    icon: Leaf,
    color: 'bg-cyan-100 text-cyan-600 dark:bg-cyan-900/30 dark:text-cyan-300',
    details: {
      physiology:
        'В окне 36-48 часов кетоновый обмен обычно становится более устойчивым: уровень бета-гидроксибутирата растет, а мозг начинает заметнее использовать кетоны в качестве топлива. Это снижает зависимость центральной нервной системы от постоянного притока глюкозы.\n\nПечень продолжает производить глюкозу для обязательных потребителей, но белково-углеводный обмен уже работает в более экономном режиме. Параллельно сохраняется активная мобилизация жирных кислот как главного энергетического источника.\n\nМетаболическая вариабельность между приемами пищи исчезает, и регуляция переходит к более стабильному «внутреннему» циклу, где основные колебания задаются гормональной и циркадной адаптацией.',
      sensations: [
        'Чувство голода обычно слабее, чем в первые сутки.',
        'Возможна сухость во рту и легкий дискомфорт от ограниченного рациона.',
        'Физическая слабость выражена сильнее, чем ментальная усталость.',
      ],
    },
    recommendations: [
      'Поддерживайте гидратацию и щадящий режим дня.',
      'Ограничьте активность до прогулок и легкой растяжки.',
      'Следите за качеством сна и температурным комфортом.',
    ],
    precautions: [
      'Если симптомы ухудшаются, а не стабилизируются, протокол нужно завершать.',
      'При нарушениях ритма сердца или выраженной слабости нужна очная оценка.',
    ],
  },
  {
    id: 7,
    hoursStart: 48,
    hoursEnd: 72,
    title: 'Стабильная кетозная фаза',
    subtitle: '2-3 сутки',
    icon: Trophy,
    color: 'bg-teal-100 text-teal-600 dark:bg-teal-900/30 dark:text-teal-300',
    details: {
      physiology:
        'Ко 2-3 суткам формируется относительно стабильная кетозная архитектура: кетоновые тела становятся регулярным энергетическим компонентом для мозга и мышц в покое, а колебания глюкозы сглаживаются.\n\nОрганизм стремится сохранить структурные белки, перераспределяя нагрузку в пользу жирового обмена. Глюконеогенез продолжается на «обслуживающем» уровне, а гормональный профиль удерживает баланс между доступностью энергии и экономией расхода.\n\nНа системном уровне эта фаза отражает наиболее выраженную адаптацию к внутреннему питанию в рамках краткосрочного протокола, когда энергетические цепочки работают уже не в стартовом, а в устойчивом переходном режиме.',
      sensations: [
        'Относительная стабильность аппетита и настроения.',
        'Энергия для интеллектуальных задач может быть сохранена.',
        'Физическая выносливость остается ограниченной.',
      ],
    },
    recommendations: [
      'Оставляйте только низкоинтенсивную активность и восстановление.',
      'Контролируйте сон, уровень стресса и гидратацию.',
      'Планируйте мягкий выход заранее, не в последний момент.',
    ],
    precautions: [
      'Сильная слабость, спутанность сознания или ухудшение координации - повод завершить голодание.',
      'При хронических заболеваниях этот этап желательно проходить под наблюдением.',
    ],
  },
  {
    id: 8,
    hoursStart: 72,
    hoursEnd: 120,
    title: 'Продленное голодание',
    subtitle: 'Усиленный контроль состояния',
    icon: Shield,
    color: 'bg-slate-100 text-slate-600 dark:bg-slate-800/60 dark:text-slate-300',
    details: {
      physiology:
        'После 72 часов метаболизм входит в продленную адаптацию: кетогенез остается высоким, а общий энергетический расход может снижаться за счет более экономного гормонального профиля. Щитовидная и симпатоадреналовая регуляция начинают перестраиваться под длительный дефицит внешнего топлива.\n\nЖировой обмен продолжает доминировать, но цена метаболической экономии постепенно растет: возрастает чувствительность к дефициту жидкости, электролитов и восстановительных ресурсов. Удержание гомеостаза становится более «тонкой» задачей для регуляторных систем.\n\nПо мере удлинения протокола физиологический резерв зависит от исходного состояния организма и объема доступных энергетических депо, поэтому индивидуальная вариабельность реакций существенно увеличивается.',
      sensations: [
        'Снижение физического ресурса на фоне более экономного метаболизма.',
        'Возможны эпизоды апатии, сонливости или раздражительности.',
        'Чувствительность к стрессу, холоду и недосыпу повышается.',
      ],
    },
    recommendations: [
      'Снизьте нагрузку до минимума и добавьте больше периодов отдыха.',
      'Пейте воду регулярно, контролируйте признаки обезвоживания.',
      'Продумайте пошаговый выход с микропорциями и паузами.',
    ],
    precautions: [
      'Нарастающая слабость, судороги, выраженные сердечные симптомы требуют немедленной остановки.',
      'Продолжение этого этапа без медицинского контроля повышает риск осложнений.',
    ],
  },
  {
    id: 9,
    hoursStart: 120,
    hoursEnd: 168,
    title: 'Высокорисковый продленный этап',
    subtitle: '5-7 сутки и далее',
    icon: Moon,
    color: 'bg-stone-100 text-stone-600 dark:bg-stone-800/60 dark:text-stone-300',
    details: {
      physiology:
        'На интервале 5-7 суток и далее организм поддерживает глубокий адаптивный режим с максимальной экономией субстратов. Кетоновый обмен остается ведущим, но при ограниченных жировых резервах может расти доля катаболизма структурных тканей.\n\nНейрогуморальные системы работают в условиях повышенной нагрузки: даже небольшие сдвиги по жидкости, натрию, калию или объему циркулирующей крови могут сильнее отражаться на самочувствии и сердечно-сосудистой динамике.\n\nОтдельным физиологическим риском становится фаза рефидинга: после длительного дефицита резкое возвращение питания способно вызвать выраженные электролитные колебания. Поэтому длительный этап требует особенно аккуратной метаболической «перенастройки» при выходе.',
      sensations: [
        'Выраженная физическая утомляемость даже при обычной активности.',
        'Нестабильное настроение, проблемы со сном, снижение концентрации.',
        'Повышенная чувствительность к обезвоживанию и стрессу.',
      ],
    },
    recommendations: [
      'Рассматривайте завершение протокола как приоритет, а не продолжение любой ценой.',
      'Переходите к мягкому выходу: небольшие порции, постепенное расширение рациона.',
      'Сохраняйте максимальный щадящий режим до восстановления питания.',
    ],
    precautions: [
      'При любых выраженных симптомах (боль в груди, обморок, спутанность) требуется немедленное прекращение и медицинская помощь.',
      'Длительные протоколы этого уровня безопаснее проводить только под клиническим наблюдением.',
    ],
  },
];
